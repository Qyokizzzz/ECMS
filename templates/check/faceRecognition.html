<html class="no-js">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
{% load staticfiles %}
<title>Education Management System</title>
<meta name="description" content="这是一个 index 页面">
<meta name="keywords" content="index">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="icon" type="image/png" href="{% static '/i/favicon.png' %}">
<link rel="apple-touch-icon-precomposed" href="{% static '/i/app-icon72x72@2x.png' %}">
<meta name="apple-mobile-web-app-title" content="Amaze UI" />
<link rel="stylesheet" href="{% static '/css/amazeui.min.css' %}"/>
<link rel="stylesheet" href="{% static '/css/admin.css' %}">
<script src="{% static '/js/jquery.min.js' %}"></script>
<script src="{% static '/js/app.js' %}"></script>
</head>

<body>
<header class="am-topbar admin-header">
<div class="am-topbar-brand"><img src="{% static '/i/logo.png' %}"></div>
<div class="am-collapse am-topbar-collapse" id="topbar-collapse">
<ul class="am-nav am-nav-pills am-topbar-nav admin-header-list">
	<li class="am-dropdown tognzhi" data-am-dropdown>
	  <button class="am-btn am-btn-primary am-dropdown-toggle am-btn-xs am-radius am-icon-bell-o" data-am-dropdown-toggle> 消息管理<span class="am-badge am-badge-danger am-round">6</span></button>
	  <ul class="am-dropdown-content">
	    <li class="am-dropdown-header">所有消息都在这里</li>
	    <li><a href="#">未激活会员 <span class="am-badge am-badge-danger am-round">556</span></a></li>
	    <li><a href="#">未激活代理 <span class="am-badge am-badge-danger am-round">69</span></a></li>
	    <li><a href="#">未处理汇款</a></li>
	    <li><a href="#">未发放提现</a></li>
	    <li><a href="#">未发货订单</a></li>
	    <li><a href="#">低库存产品</a></li>
	    <li><a href="#">信息反馈</a></li>
	  </ul>
	</li>

</ul>
</div>
</header>
<div class="am-cf admin-main">
{{ request.session.sidebarStr|safe }}
<div class=" admin-content">
		<div class="daohang">
			<ul>
				<li><button type="button" class="am-btn am-btn-default am-radius am-btn-xs"> 首页</button></li>
				<li><button type="button" class="am-btn am-btn-default am-radius am-btn-xs">二级<a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close="">×</a></button></li>
			</ul>
		</div>
<div class="admin">
	<!-- 在这里加入内容 -->
    <form method="post" enctype="multipart/form-data">
        <div>
            <video id="video" width="654px" height="500px" autoplay="autoplay"></video>
            <canvas id="canvas" width="654px" height="500px"></canvas>
        </div>
        <div>
            <input  type="button" title="开启摄像头" value="开启摄像头" onclick="getMedia()" />
            <button id="snap" type="submit" onclick="takePhoto()">发起考勤</button>
            <label for="clazz">班级：</label>
            <input tpye="text" id='clazz' name='clazz'/>
        </div>

    </form>
    <div class="foods">
    	<ul>毕设</ul>
    	<dl><a href="" title="返回头部" class="am-icon-btn am-icon-arrow-up"></a></dl>
    </div>
</div>
</div>
</div>
<script src="{% static '/js/amazeui.min.js' %}"></script>
<script>
        let video = document.getElementById("video");
        function getMedia(){
            let constraints={
                video: { width: 654, height: 500 },
                audio: false
            };
            let promise = navigator.mediaDevices.getUserMedia(constraints);
            promise.then(function (MediaStream) {
                video.srcObject = MediaStream;
                video.play();
            }).catch(function (PermissionDeniedError) {
                console.log(PermissionDeniedError);
            })
        }
        function takePhoto(){
            let canvas = document.getElementById("canvas");
            let ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, 654, 500);
            var photoSrc = document.getElementById("canvas").toDataURL("image/jpeg", 1);
            console.log(photoSrc, 12121);
            var face_str = photoSrc.substr(22);
            var clazz = $('#clazz').val();
            var formdata = new FormData();
            formdata.append("face_str", face_str);
            formdata.append("clazz", clazz);
            $.ajax({
                url: "/recognize/",
                type: "post",
                data:formdata,
                processData: false,
                contentType: false,
                async : false,
                success: function (data) {
                    alert("success");
                },
                error:function(err){
                   alert("服务器错误");
                }
            });
        }
</script>
</body>
</html>